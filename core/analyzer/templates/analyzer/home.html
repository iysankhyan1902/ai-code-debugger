<!DOCTYPE html>
<html lang="en">
<head>
    <title>AI Code Debugging Assistant</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>


<div class="hero">
    <h1>AI Code Debugging Assistant</h1>
    <p>Analyze Python errors and get clear, reliable fixes powered by AI.</p>
</div>

<!-- MAIN CONTENT -->
<div class="container">

    <!-- MAIN APP CARD -->
    <div class="card main-card">
        <form id="debugForm">

            <label class="section-title">Python Code</label>
            <textarea id="code" class="code-box" placeholder="Paste your Python code"></textarea>
            
            <label class="section-title">Error Message</label>
            <textarea id="error" class="error-box" placeholder="Paste the error message"></textarea>


            <div class="radio-group">
                <label>
                    <input type="radio" name="mode" value="hint"> Hint only
                </label>
                <label>
                    <input type="radio" name="mode" value="full" checked> Full solution
                </label>
            </div>

            <button type="submit">Debug Code</button>
        </form>
    </div>

    <!-- OUTPUT CARD -->
    <div class="card output-card">
        <h3>AI Analysis</h3>
        <pre id="output">Waiting for input...</pre>
    </div>

</div>

<script>
document.getElementById("debugForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const code = document.getElementById("code").value;
    const error = document.getElementById("error").value;
    const mode = document.querySelector('input[name="mode"]:checked').value;
    const output = document.getElementById("output");

    if (!code.trim()) {
        output.innerText = "Please enter code before submitting.";
        return;
    }

    if (!error.trim()) {
        output.innerText = "Please enter the error message.";
        return;
    }

    output.innerText = "Analyzing code and error...";

    const response = await fetch("/debug/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({ code, error, mode })
    });

    const data = await response.json();
    output.innerText = data.error || data.result;
});
</script>

</body>
</html>

